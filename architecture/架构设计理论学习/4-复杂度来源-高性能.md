## 复杂度来源：高性能

软件系统中高性能带来的复杂度主要体现在两个方面，一方面是单台计算机内部为了高性能带来的复杂度；另一方面是多台计算机集群为了高性能带来的复杂度。

#### 单机复杂度

单台计算机内部最复杂最关键的部分就是操作系统，操作系统中跟应用软件系统性能相关的是进程和线程。操作系统发展到现在，如果我们要完成一个高性能的软件系统，需要考虑多进程、多线程、进程间通信、多线程并发等技术点。而且这些技术并不是最新的就是最好的，也不是非此即彼的。

在做架构设计的时候，需要花很大精力来结合业务进行分析、判断、选择、组合、这个过程同样很复杂。举个例子：Nginx 可以用多进程也可以用多线程，JBoss 采用的是多线程；Redis 采用的是单进程，Memcache 采用的是多线程。这些系统都实现了高性能，但内部实现差异却很大。

#### 集群的复杂度

1. 任务分配

   每台机器都可以处理完整的业务任务，不同的任务分配到不同的机器上执行。例如：无状态服务的横向扩展。

   一台机器扩展为多台以后，还需要在之前放置任务分配器。如果扩展的执行任务的机器数量巨大，则要增加多台任务分配器处理，不然任务分配器就会成为整个系统的瓶颈。而且，横向扩展的数量级，与整个系统的处理能力并不是以1：1的比例增长的。简单考虑的话，可以按照1：0.8简单计算。

2. 任务分解

   通过任务分配的方式，我们能够突破单台机器处理性能的瓶颈，通过增加更多的机器来满足业务的性能需求。但如果业务本身也越来越复杂，单纯只通过任务分配的方式来扩展性能，收益会越来越低。

   我们可以采用任务分解的方式来继续提升性能。例如，微信后台架构从逻辑上将各个子任务进行了拆分，包括：接入、注册登录、消息、LBS、摇一摇、漂流瓶、其他业务（聊天、视频、朋友圈等）。通过任务分解的方式，能够把原来大一统但复杂的业务系统，拆分成小而简单但需要多个子系统配合的业务系统。

   - 简单的系统更加容易做到高性能
   - 可以针对单个任务进行扩展

